"use strict";(self["webpackChunkaw_webui"]=self["webpackChunkaw_webui"]||[]).push([[4844],{54844:(t,e,n)=>{n.r(e),n.d(e,{default:()=>_});var a=function(){var t=this,e=t._self._c;return e("div",[e("h1",[t._v("Timespiral")]),e("b-alert",{attrs:{show:"",variant:"info"}},[t._v("This is a work-in-progress experiment.")]),e("div",[t._v("Bucket: "+t._s(t.bucketId))]),e("div",[t._v("Events: "+t._s(t.events.length))]),e("Timespiral",{attrs:{events:t.events}})],1)},r=[],s=n(70068),i=n(1952),o=(n(79389),n(28743),n(90296)),u=function(){var t=this,e=t._self._c;return e("div",[e("svg",{attrs:{id:"timespiral"}})])},c=[],l=n(75530),d=n(49807),f=n(26254),h=(n(7899),n(30959),n(17),n(5086),n(533),n(59581),n(80115),n(10557),n(35231),n(47746),n(43148),n(58476),n(58379),n(80475),n(21243)),v=n(95093),p=n.n(v);function m(t){t=JSON.parse(JSON.stringify(t));var e=t.filter((function(t){var e=p()(t.timestamp),n=p()(t.timestamp).add(t.duration,"seconds");return!e.isSame(n,"hour")})),n=e.map((function(t){for(var e=p()(t.timestamp),n=p()(t.timestamp).add(t.duration,"seconds"),a=[(0,f.A)((0,f.A)({},t),{},{duration:p()(e).startOf("hour").add(1,"hour").diff(e,"seconds")}),(0,f.A)((0,f.A)({},t),{},{timestamp:p()(n).startOf("hour").format(),duration:p()(n).diff(n.startOf("hour"),"seconds")})],r=e.startOf("hour").add(1,"hour");r<n.startOf("hour");r.add(1,"hour")){var s=(0,f.A)((0,f.A)({},t),{},{timestamp:r.format(),duration:3600});a.push(s)}return a})).reduce((function(t,e){return t.concat(e)}),[]);return t.filter((function(t){return!e.includes(t)})).concat(n).sort((function(t,e){var n=p()(t.timestamp),a=p()(e.timestamp);return n.diff(a)})).reverse()}const A={name:"Timespiral",props:{events:{type:Array,default:function(){return[]}}},data:function(){return{}},computed:{split_on_hour:function(){return this.events&&this.events.length>0?m(this.events):[]}},watch:{events:function(){this.renderChart()}},mounted:function(){this.renderChart()},updated:function(){this.renderChart()},beforeUpdate:function(){var t=h.select("svg");t.selectAll("*").remove()},methods:{renderChart:function(){if(0!=this.events.length){var t,e=this.split_on_hour,n=600,a=600,r=60,s=5,i=250/s,o=20,u=i+o+20,c=h.select("svg#timespiral").style("height","".concat(n,"px")).style("width","".concat(a,"px")),f=c.append("g").attr("transform","translate(".concat(a/2,", ").concat(a/2,")")),v=h.extent(e.map((function(t){return t.timestamp}))),m=p()(v[0]).startOf("day"),A=p()(v[1]).endOf("day");t=A.clone().diff(m)/1e3>s?[A.clone().subtract(s,"days").toDate(),A.toDate()]:[m.toDate(),A.toDate()];var g=Math.ceil((t[1].valueOf()-t[0].valueOf())/864e5);e=e.filter((function(e){return p()(e.timestamp).isAfter(t[0])}));var y=h.scaleTime().domain(t).range([0,2*Math.PI*g]),k=h.scaleTime().domain(t).range([u+(a-r)/2-(i+o)*g,(a-2*r)/2]),w=h.scalePow().exponent(2).domain(t).range([i/(s-1),i]);e.forEach((function(t){t.startAngle=y(new Date(t.timestamp)),t.endAngle=y(new Date(t.timestamp).valueOf()+1e3*t.duration);var e=.05,n=p()(t.timestamp).startOf("hour");t.startAngle+=(t.startAngle-y(n))*e,t.endAngle-=(t.endAngle-y(n))*e}));var x=h.arc().innerRadius((function(t){var n=C(e[t.data].timestamp,!0),a=(0,d.A)(n,2),r=a[0],s=a[1];return r-s/2})).outerRadius((function(t){var n=C(e[t.data].timestamp,!0),a=(0,d.A)(n,2),r=a[0],s=a[1];return r+s/2})).cornerRadius(2);e.forEach((function(t,e){var n=h.pie().sort(null).startAngle(t.startAngle).endAngle(t.endAngle).value(p()(t.timestamp).valueOf())([e]);f.append("g").selectAll("path").data(n).join("path").attr("d",x).attr("stroke","none").attr("fill","not-afk"==t.data.status?"#0d0":"#ccc").attr("opacity",.7)}));var O="#888",b="#ccc",_=k(t[1]);I(f,0,0,"00:00",_,!0),I(f,3,0,"",_),I(f,6,0,"06:00",_,!0),I(f,9,0,"",_),I(f,12,0,"12:00",_,!0),I(f,15,0,"",_),I(f,18,0,"18:00",_,!0),I(f,21,0,"",_);var M=p()();I(f,M.hour(),M.minute(),"Now",_);var D=h.timeDays.apply(h,(0,l.A)(t));D.forEach((function(t){return T(f,t)})),P(f,4*g-1)}function C(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e?p()(t).startOf("hour").valueOf():p()(t).valueOf();return[k(n),w(n)]}function E(t,e,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=Math.cos(e),s=Math.sin(e);t.append("line").attr("x1",(n-5)*r).attr("y1",(n-5)*s).attr("x2",(n+5)*r).attr("y2",(n+5)*s).style("stroke",b).style("stroke-width",2),a&&t.append("line").attr("x1",0).attr("y1",0).attr("x2",(n-5)*r).attr("y2",(n-5)*s).style("stroke","#fff").style("stroke-width",2)}function I(t,e,n,a,r){var s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=2*Math.PI*(e/24+n/24/60)-.5*Math.PI;E(f,i,r,s);var o=Math.cos(i),u=Math.sin(i);t.append("text").text(a||p()({hours:e}).format("HH:mm")).attr("text-anchor",6==e?"start":18==e?"end":"middle").attr("dominant-baseline","middle").attr("font-size","1em").style("fill",O).attr("x",(r+10)*o).attr("y",(r+20)*u)}function T(t,e){var n=k(p()(e).add(8,"hours")),a=k(p()(e).add(14,"hours")),r=(a-n)/4,s=p()(e).startOf("day"),o="wavy".concat(e.valueOf()),u="M 2,-".concat(n," A ").concat(n+r,",").concat(n+r," 0 0 1 ").concat(a,",0");t.append("path").attr("id",o).attr("d",u).style("fill","none").style("stroke","#AAAAAA").style("stroke-width",0),t.append("text").append("textPath").text(s.format("Y-M-D")).attr("xlink:href","#".concat(o)).attr("text-anchor","left").attr("font-size","".concat(1*Math.max(w(s)/i,.5),"em")).style("fill","#555")}function P(t,e){for(var n=90,a=[],r=0;r<e*n;r++){var s=r*Math.PI/2/n,i=y.invert(s),o=C(i),u=(0,d.A)(o,2),c=u[0],l=u[1],f=l/4;a.push((c-f)*Math.cos(s)),a.push((c-f)*Math.sin(s))}t.append("polyline").attr("points",a.join(" ")).attr("stroke","#ccc").attr("stroke-width",1).attr("fill","none")}}}},g=A;var y=n(81656),k=(0,y.A)(g,u,c,!1,null,null,null);const w=k.exports,x={name:"TimespiralView",components:{Timespiral:w},data:function(){return{events:[],bucketId:""}},mounted:function(){var t=this;return(0,i.A)((0,s.A)().mark((function e(){var n,a,r;return(0,s.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=(0,o._)(),e.next=3,n.ensureLoaded();case 3:if(a=n.bucketsAFK(n.hosts[0]),0!=a.length){e.next=7;break}return console.warn("Couldn't find suitable bucket"),e.abrupt("return");case 7:return t.bucketId=a[0],e.next=10,n.getBucketWithEvents({id:t.bucketId,start:new Date("2022-08-08")});case 10:r=e.sent,t.events=r.events,console.log("Retrieved events:",t.events),console.log("First/last event:",t.events[0],t.events[t.events.length-1]);case 14:case"end":return e.stop()}}),e)})))()},methods:{onEventClick:function(t){this.$store.commit("setSelectedEvent",t),this.$router.push({name:"EventView"})}}},O=x;var b=(0,y.A)(O,a,r,!1,null,null,null);const _=b.exports}}]);
//# sourceMappingURL=4844.9b68fac2.js.map